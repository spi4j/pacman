[comment encoding = UTF-8 /]
[module genValidationOperations('http://www.obeonetwork.org/dsl/soa/4.0.0',
                                'http://www.obeonetwork.org/dsl/environment/3.0.0')/]

[import fr::pacman::commons::common::packages /]
[import fr::pacman::validation::common::tools /]

[template public genValidationOperations(m : System)]
    [comment]Vérification des opérations[/comment]
    [file ('GraalSoaResult.txt', false, 'UTF-8')]
        [for (service : Service | m.eAllContents(Service))]
            [if service.ownedInterface <> null]
            [for (operation : Operation | service.ownedInterface.ownedOperations)]
                [if operation.input->isEmpty() and operation.output->isEmpty()]
[updview(operation, 2, 'Cette opération n''a aucun paramètre')/]
                [/if]
                [for (param : Parameter | operation.input->union(operation.output))]
                    [if param.name = null or param.name.trim().size() = 0]
[updview(param, 1, 'Ce paramètre n''a pas de nom')/]
                    [/if]
                    [if param.type = null]
[updview(param, 1, 'Ce paramètre n''a pas de type')/]
                    [else]
                        [if not param.type.oclIsKindOf(PrimitiveType) and not param.type.oclIsKindOf(DTO)  or (param.type.oclIsKindOf(PrimitiveType) and param.type.name = 'Email')]
[updview(param, 1, 'Ce paramètre a un mauvais type (doit être un DTO ou un type primitif, sauf Email)')/]
                        [/if]
                    [/if]
                [/for]
            [/for]
            [else]
[updview(service, 2, 'Ce service n''a pas d''interface')/]
            [/if]
        [/for]
    [/file]
[/template]
