[module genValidationOperations('http://www.obeonetwork.org/dsl/soa/4.0.0', 'http://www.obeonetwork.org/dsl/environment/3.0.0')/]

[import fr::pacman::commons::common::packages/]
[import fr::pacman::validation::common::tools/]

[comment encoding = UTF-8 /]
[template public genValidationOperations(m : soa::System)]
  [file ('GraalSoaResult.txt', overwrite, 'UTF-8')]
    [for (service : soa::Service | m.eAllContents(soa::Service))]
      [if (service.ownedInterface <> null)]
        [for (operation : soa::Operation | service.ownedInterface.ownedOperations)]
          [if (operation.input->isEmpty() and operation.output->isEmpty())]
            [operation.updview(2, 'Cette opération na aucun paramètre')/]
          [/if]
          [for (param : soa::Parameter | operation.input->union(operation.output))]
            [if (param.name = null or param.name.trim().size() = 0)]
              [param.updview(1, 'Ce paramètre na pas de nom')/]
            [/if]
            [if (param.type = null)]
              [param.updview(1, 'Ce paramètre na pas de type')/]
            [else]
              [if (not param.type.oclIsKindOf(environment::PrimitiveType) and not param.type.oclIsKindOf(environment::DTO) or param.type.oclIsKindOf(environment::PrimitiveType) and param.type.name = 'Email')]
                [param.updview(1, 'Ce paramètre a un mauvais type (doit être un DTO ou un type primitif, sauf Email)')/]
              [/if]
            [/if]
          [/for]
        [/for]
      [else]
        [service.updview(2, 'Ce service na pas dinterface')/]
      [/if]
    [/for]
  [/file]
[/template]